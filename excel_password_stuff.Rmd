---
title: "excel_password_accessing"
author: "Dave Lovell"
date: "14/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Excel Files

```{r files}
dir(pattern = ".*\\.xlsx")
```

One of them is password protected, one isn't.

## Copying Some Code From the Internet

[Here](https://stat.ethz.ch/pipermail/r-help/2011-March/273678.html), specifically.

You'll need to install package `RDCOMClient`, which is non-CRAN, apparently.

```{r internetCode}
# devtools::install_github("omegahat/RDCOMClient")
# devtools::install_github("dkyleward/RDCOMClient")
library("RDCOMClient")
eApp <-  COMCreate("Excel.Application")

file.exists("C:/Users/david.lovell/Documents/repos/excel-passwording/file_with_a_password.xlsx")
# noPassword <-  eApp$Workbooks()$Open(Filename = "C:/Users/david.lovell/Documents/repos/excel-passwording/file_without_a_password.xlsx")
password <-  eApp$Workbooks()$Open(Filename = "C:/Users/david.lovell/Documents/repos/excel-passwording/file_with_a_password.xlsx",
                                   Password = "top secret password")

tf <- tempfile(fileext = ".xlsx")
password$Sheets(1)$SaveAs(tf, 3)

read.table(tf, sep = "\t")
```

Okay, struggling to get the above to work because my personal laptop doesn't have Excel and my work laptop doesn't have Rtools! Need to get the latter sorted. I think I might have found a CRAN method though, looks way simpler (but I suspect is using RDCOM under the hood?)

## CRAN Method

```{r CRANMethod}
# library("excel.link")
# 
# excel.link::xl.read.file(file = "file_with_a_password.xlsx",
#                          password = "top_secret_password",
#                          write.res.password = "top_secret_password",
#                          xl.sheet = "Sheet1") -> excelOut
```

The above code crashed R a couple of times, I'm not sure why. 